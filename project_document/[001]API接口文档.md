# 飞书仿真系统 API 接口文档

## 基础信息

- **Base URL**: `http://localhost:8080`
- **Content-Type**: `application/json`
- **认证方式**: JWT Token (Header: `Authorization: Bearer {token}`)

---

## 一、用户认证模块

### 1.1 用户注册

**接口地址**: `POST /api/auth/register`

**是否需要认证**: 否

**请求格式**: `application/json`

**请求参数**:

```json
{
  "username": "zhangsan",
  "password": "123456",
  "realName": "张三",
  "studentId": "2021001"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | String | 是 | 用户名 |
| password | String | 是 | 密码 |
| realName | String | 是 | 真实姓名 |
| studentId | String | 是 | 学号 |

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

### 1.2 用户登录

**接口地址**: `POST /api/auth/login`

**是否需要认证**: 否

**请求格式**: `application/x-www-form-urlencoded` (表单)

**请求参数**:

- `username` - 用户名
- `password` - 密码

**请求示例**:

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -d "username=zhangsan" \
  -d "password=123456"
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userId": "550e8400-e29b-41d4-a716-446655440000",
    "username": "zhangsan",
    "realName": "张三",
    "role": "STUDENT"
  }
}
```

---

### 1.3 获取当前用户信息

**接口地址**: `GET /api/user/info`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "userId": "550e8400-e29b-41d4-a716-446655440000",
    "username": "zhangsan",
    "password": null,
    "realName": "张三",
    "email": "zhangsan@qq.com",
    "phone": "13800138000",
    "avatar": "/default-avatar.png",
    "role": "STUDENT",
    "studentId": "2021001",
    "teacherId": null,
    "status": 1,
    "createTime": "2024-01-01T10:00:00",
    "updateTime": "2024-01-01T10:00:00"
  }
}
```

---

### 1.4 完善用户信息

**接口地址**: `PUT /api/user/info`

**是否需要认证**: 是

**请求格式**: `application/json`

**请求头**:

```
Authorization: Bearer {token}
```

**请求参数** (所有字段可选):

```json
{
  "realName": "张三丰",
  "email": "zhangsan@qq.com",
  "phone": "13800138000",
  "avatar": "/avatar/zhangsan.jpg"
}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

## 二、项目管理模块

### 2.1 创建项目（教师）

**接口地址**: `POST /api/project`

**是否需要认证**: 是（仅教师）

**请求格式**: `application/json`

**请求头**:

```
Authorization: Bearer {token}
```

**请求参数**:

```json
{
  "projectName": "软件项目管理课程项目",
  "description": "2024春季学期项目",
  "startTime": "2024-03-01T00:00:00",
  "endTime": "2024-06-30T23:59:59",
  "maxGroupSize": 6,
  "minGroupSize": 3,
  "groupDeadline": "2024-03-15T23:59:59",
  "allowStudentCreateGroup": 1
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| projectName | String | 是 | 项目名称 |
| description | String | 否 | 项目描述 |
| startTime | DateTime | 否 | 开始时间 |
| endTime | DateTime | 否 | 结束时间 |
| maxGroupSize | Integer | 否 | 最大小组人数（默认6） |
| minGroupSize | Integer | 否 | 最小小组人数（默认3） |
| groupDeadline | DateTime | 否 | 小组创建截止时间 |
| allowStudentCreateGroup | Integer | 否 | 是否允许学生创建小组（1-允许，0-不允许，默认1） |

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "projectId": "uuid",
    "projectName": "软件项目管理课程项目",
    "projectCode": "PRJ20240101ABC",
    "description": "2024春季学期项目",
    "creatorId": "teacher-uuid",
    "status": 1,
    "maxGroupSize": 6,
    "minGroupSize": 3,
    "createTime": "2024-01-01T10:00:00"
  }
}
```

---

### 2.2 更新项目（教师）

**接口地址**: `PUT /api/project/{projectId}`

**是否需要认证**: 是（仅教师）

**请求格式**: `application/json`

**请求头**:

```
Authorization: Bearer {token}
```

**请求参数** (所有字段可选):

```json
{
  "projectName": "新项目名称",
  "description": "新描述",
  "status": 2,
  "maxGroupSize": 8,
  "minGroupSize": 4
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| projectName | String | 否 | 项目名称 |
| description | String | 否 | 项目描述 |
| startTime | DateTime | 否 | 开始时间 |
| endTime | DateTime | 否 | 结束时间 |
| status | Integer | 否 | 状态（1-准备中，2-进行中，3-已结束，4-已取消） |
| maxGroupSize | Integer | 否 | 最大小组人数 |
| minGroupSize | Integer | 否 | 最小小组人数 |
| groupDeadline | DateTime | 否 | 小组创建截止时间 |
| allowStudentCreateGroup | Integer | 否 | 是否允许学生创建小组 |

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

### 2.3 删除项目（教师）

**接口地址**: `DELETE /api/project/{projectId}`

**是否需要认证**: 是（仅教师）

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

### 2.4 获取项目详情

**接口地址**: `GET /api/project/{projectId}`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "projectId": "uuid",
    "projectName": "软件项目管理课程项目",
    "projectCode": "PRJ20240101ABC",
    "description": "2024春季学期项目",
    "creatorId": "teacher-uuid",
    "startTime": "2024-03-01T00:00:00",
    "endTime": "2024-06-30T23:59:59",
    "status": 1,
    "maxGroupSize": 6,
    "minGroupSize": 3,
    "groupDeadline": "2024-03-15T23:59:59",
    "allowStudentCreateGroup": 1,
    "createTime": "2024-01-01T10:00:00",
    "updateTime": "2024-01-01T10:00:00"
  }
}
```

---

### 2.5 通过项目编码获取项目

**接口地址**: `GET /api/project/code/{projectCode}`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**请求示例**:

```bash
curl -X GET http://localhost:8080/api/project/code/PRJ20240101ABC \
  -H "Authorization: Bearer {token}"
```

**成功响应**: 同2.4

---

### 2.6 获取我的项目列表

**接口地址**: `GET /api/project/my`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "projectId": "uuid1",
      "projectName": "项目1",
      "projectCode": "PRJ20240101ABC",
      "status": 2
    },
    {
      "projectId": "uuid2",
      "projectName": "项目2",
      "projectCode": "PRJ20240102DEF",
      "status": 1
    }
  ]
}
```

---

### 2.7 获取所有项目

**接口地址**: `GET /api/project/all`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**: 同2.6

---

### 2.8 加入项目（学生）

**接口地址**: `POST /api/project/join`

**是否需要认证**: 是

**请求格式**: `application/json`

**请求头**:

```
Authorization: Bearer {token}
```

**请求参数**:

```json
{
  "projectCode": "PRJ20240101ABC"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| projectCode | String | 是 | 项目编码 |

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

### 2.9 退出项目

**接口地址**: `DELETE /api/project/{projectId}/quit`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**说明**: 项目创建者（教师）不能退出项目

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

### 2.10 获取项目成员列表

**接口地址**: `GET /api/project/{projectId}/members`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "projectMemberId": "uuid1",
      "projectId": "project-uuid",
      "userId": "user-uuid1",
      "roleInProject": "OWNER",
      "joinTime": "2024-01-01T10:00:00",
      "status": 1
    },
    {
      "projectMemberId": "uuid2",
      "projectId": "project-uuid",
      "userId": "user-uuid2",
      "roleInProject": "MEMBER",
      "joinTime": "2024-01-02T10:00:00",
      "status": 1
    }
  ]
}
```

---

## 三、小组管理模块

### 3.1 创建小组（学生）

**接口地址**: `POST /api/group`

**是否需要认证**: 是

**请求格式**: `application/json`

**请求头**:

```
Authorization: Bearer {token}
```

**请求参数**:

```json
{
  "projectId": "project-uuid",
  "groupName": "第一小组",
  "description": "我们是最棒的小组"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| projectId | String | 是 | 项目ID |
| groupName | String | 是 | 小组名称 |
| description | String | 否 | 小组描述 |

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "groupId": "group-uuid",
    "projectId": "project-uuid",
    "groupName": "第一小组",
    "groupCode": "GRP001",
    "description": "我们是最棒的小组",
    "leaderId": "user-uuid",
    "creatorId": "user-uuid",
    "currentMembers": 1,
    "maxMembers": 6,
    "status": 1,
    "createTime": "2024-01-01T10:00:00"
  }
}
```

---

### 3.2 获取小组详情

**接口地址**: `GET /api/group/{groupId}`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "groupId": "group-uuid",
    "projectId": "project-uuid",
    "groupName": "第一小组",
    "groupCode": "GRP001",
    "description": "我们是最棒的小组",
    "leaderId": "user-uuid",
    "creatorId": "user-uuid",
    "currentMembers": 3,
    "maxMembers": 6,
    "status": 1,
    "createTime": "2024-01-01T10:00:00",
    "updateTime": "2024-01-01T10:00:00"
  }
}
```

---

### 3.3 获取项目的所有小组

**接口地址**: `GET /api/group/project/{projectId}`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "groupId": "group-uuid1",
      "projectId": "project-uuid",
      "groupName": "第一小组",
      "groupCode": "GRP001",
      "currentMembers": 3,
      "maxMembers": 6,
      "status": 1
    },
    {
      "groupId": "group-uuid2",
      "projectId": "project-uuid",
      "groupName": "第二小组",
      "groupCode": "GRP002",
      "currentMembers": 5,
      "maxMembers": 6,
      "status": 1
    }
  ]
}
```

---

### 3.4 获取我在项目中的小组

**接口地址**: `GET /api/group/my/{projectId}`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "groupId": "group-uuid",
    "projectId": "project-uuid",
    "groupName": "第一小组",
    "groupCode": "GRP001",
    "leaderId": "user-uuid",
    "currentMembers": 3,
    "maxMembers": 6,
    "status": 1
  }
}
```

**说明**: 如果用户不在任何小组中，返回 `data: null`

---

### 3.5 加入小组（学生）

**接口地址**: `POST /api/group/{groupId}/join`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

**业务规则**:
- 必须是项目成员
- 在该项目中还没有小组
- 小组未满员
- 小组状态正常

---

### 3.6 退出小组

**接口地址**: `DELETE /api/group/{groupId}/quit`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

**说明**: 组长不能直接退出，需要先转让组长或解散小组

---

### 3.7 获取小组成员列表

**接口地址**: `GET /api/group/{groupId}/members`

**是否需要认证**: 是

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "groupMemberId": "member-uuid1",
      "groupId": "group-uuid",
      "userId": "user-uuid1",
      "roleInGroup": "LEADER",
      "username": "student1",
      "realName": "张三",
      "studentId": "2021001"
    },
    {
      "groupMemberId": "member-uuid2",
      "groupId": "group-uuid",
      "userId": "user-uuid2",
      "roleInGroup": "MEMBER",
      "username": "student2",
      "realName": "李四",
      "studentId": "2021002"
    }
  ]
}
```

---

### 3.8 解散小组（教师）

**接口地址**: `DELETE /api/group/{groupId}/dissolve`

**是否需要认证**: 是（仅教师）

**请求头**:

```
Authorization: Bearer {token}
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

**说明**: 解散后，所有成员被移除，小组状态变为"已解散"

---

### 3.9 转让组长

**接口地址**: `PUT /api/group/{groupId}/leader`

**是否需要认证**: 是

**请求格式**: `application/x-www-form-urlencoded` (表单)

**请求头**:

```
Authorization: Bearer {token}
```

**请求参数**:

- `newLeaderId` - 新组长的用户ID

**请求示例**:

```bash
curl -X PUT http://localhost:8080/api/group/{groupId}/leader \
  -H "Authorization: Bearer {token}" \
  -d "newLeaderId=new-user-uuid"
```

**成功响应**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

**说明**: 新组长必须是小组成员

---

## 四、统一返回格式

### 成功响应

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

### 失败响应

```json
{
  "code": 1003,
  "message": "用户名或密码错误",
  "data": null
}
```

---

## 四、返回码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 401 | 未授权（未登录） |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 操作失败 |
| 1001 | 用户不存在 |
| 1002 | 用户已存在 |
| 1003 | 用户名或密码错误 |
| 1004 | Token无效 |
| 1005 | Token已过期 |

---

## 五、业务规则说明

### 用户认证
- 注册时默认角色为学生（STUDENT）
- Token有效期：2小时
- 密码使用BCrypt加密

### 项目管理
- 只有教师可以创建项目
- 项目编码自动生成，格式：PRJ + 年月日 + 3位随机码
- 项目状态：1-准备中，2-进行中，3-已结束，4-已取消
- 学生通过项目编码加入项目
- 已结束或已取消的项目不能加入
- 项目创建者自动成为项目成员（角色：OWNER）
- 项目创建者不能退出项目

### 小组管理
- 学生创建小组自动成为组长
- 小组编码自动生成，格式：GRP001、GRP002...（项目内递增）
- 一个学生在一个项目中只能在一个小组
- 小组人数不能超过项目设置的 maxGroupSize
- 组长不能直接退出，需要先转让组长或解散小组
- 小组创建截止时间后不能创建新小组
- 教师可以解散小组和转让组长
- 小组状态：1-正常，2-已解散

---

## 六、测试流程

### 1. 注册学生账号

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "student1",
    "password": "123456",
    "realName": "学生一",
    "studentId": "2021001"
  }'
```

### 2. 登录获取Token

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -d "username=student1" \
  -d "password=123456"
```

### 3. 获取用户信息

```bash
curl -X GET http://localhost:8080/api/user/info \
  -H "Authorization: Bearer {token}"
```

### 4. 教师创建项目

```bash
curl -X POST http://localhost:8080/api/project \
  -H "Authorization: Bearer {teacher_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "projectName": "软件项目管理课程",
    "description": "2024春季学期",
    "maxGroupSize": 6,
    "minGroupSize": 3
  }'
```

### 5. 学生加入项目

```bash
curl -X POST http://localhost:8080/api/project/join \
  -H "Authorization: Bearer {student_token}" \
  -d "projectCode=PRJ20240101ABC"
```

### 6. 学生创建小组

```bash
curl -X POST http://localhost:8080/api/group \
  -H "Authorization: Bearer {student_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "projectId": "project-uuid",
    "groupName": "第一小组",
    "description": "我们是最棒的小组"
  }'
```

### 7. 学生加入小组

```bash
curl -X POST http://localhost:8080/api/group/{groupId}/join \
  -H "Authorization: Bearer {student_token}"
```

### 8. 获取小组成员

```bash
curl -X GET http://localhost:8080/api/group/{groupId}/members \
  -H "Authorization: Bearer {token}"
```
